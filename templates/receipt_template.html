<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>小票</title>
    <style>
        /* --- 页面尺寸和字体定义 --- */
        @font-face {
            font-family: 'ReceiptFont';
            font-weight: normal;
            src: url('fonts/NotoSansSC-Regular.ttf');
        }

        @font-face {
            font-family: 'ReceiptFont'; /* 字体家族名称保持不变 */
            font-weight: bold; /* 指定这是粗体字重 */
            src: url('fonts/NotoSansSC-Bold.ttf'); /* 指向我们的粗体文件 */
        }

        @page {
            size: 72mm 1000mm;
            margin: 3mm;
        }

        body {
            font-family: 'ReceiptFont', sans-serif;
            font-size: 10pt;
            margin: 0;
            padding: 0;
            font-weight: bold; /* 全局字体加粗 */
        }

        /* --- 通用样式 --- */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .bold { font-weight: bold; }
        .section { margin-top: 5mm; margin-bottom: 5mm; }
        .info-block div { margin-bottom: 1mm; }

        /* --- 特定元素样式 --- */
        .shop-name { font-size: 14pt; font-weight: bold; margin-bottom: 5mm; }

        hr.separator {
            border: none;
            border-top: 1px dashed #333;
            margin-top: 5mm;
            margin-bottom: 5mm;
        }

        /* --- 为表格布局设计的干净样式 --- */
        .item-table {
            width: 100%;
            border-collapse: collapse;
        }

        .item-table th {
            font-weight: bold;
            text-align: left;
            border-bottom: 1px solid #333;
            padding-bottom: 2mm;
            vertical-align: bottom;
        }

        .item-table th.qty-header {
            text-align: right;
        }

        .item-table td {
            vertical-align: top;
            padding-top: 4mm; /* 每个菜品之间的上下间隔 */
        }

        .item-qty {
            text-align: right;
            /* 给数量列一个固定的最小宽度，让其对齐更美观 */
            min-width: 40px;
            padding-left: 10px; /* 确保与商品名之间有空隙 */
        }

        .item-options {
            font-size: 8pt;
            color: #555;
            padding-top: 1mm;
        }
    </style>
</head>
<body>
    <!-- 订单头部信息 -->
    <div class="text-center shop-name">{{ order.shop_name | default('你的店铺名') }}</div>
    <div class="info-block">
        <div>订单号: {{ order.order_id | default('') }}</div>
        <div>下单时间: {{ order.created_at[:19] | default('') }}</div>
    </div>
    <div class="info-block section">
        <div>顾客姓名:
            {% set s_fname = order.shipping_address.firstName | default('', true) %}
            {% set s_lname = order.shipping_address.lastName | default('', true) %}
            {% set c_fname = order.customer_info.firstName | default('', true) %}
            {% set c_lname = order.customer_info.lastName | default('', true) %}
            {% if s_fname or s_lname %}{{ s_fname }} {{ s_lname }}{% elif c_fname or c_lname %}{{ c_fname }} {{ c_lname }}{% else %}(无姓名){% endif %}
        </div>
        <div>顾客电话: {{ order.shipping_address.phone | default('') }}</div>
        <div>顾客邮箱: {{ order.contact_email | default('') }}</div>
    </div>
    <div class="info-block">
        <div>{{ order.shipping_address.address1 | default('') }}</div>
        <div>{{ order.shipping_address.address2 | default('') }}</div>
        <div>{{ order.shipping_address.zip | default('') }} {{ order.shipping_address.countryCode | default('') }}</div>
    </div>
    <hr class="separator">

    <!-- 使用表格来布局商品列表 -->
    <table class="item-table">
        <thead>
            <tr>
                <th>商品</th>
                <th class="qty-header">数量</th>
            </tr>
        </thead>
        <tbody>
            {% for item in order.line_items %}
            <!-- 商品主行 -->
            <tr>
                <td class="item-name">{{ item.name | default('') }}</td>
                <td class="item-qty">{{ item.quantity | default(0) }}</td>
            </tr>
            <!-- 规格行 (如果存在) -->
            {% if item.option_values %}
            <tr>
                <td colspan="2" class="item-options">规格: {{ item.option_values | join(', ') }}</td>
            </tr>
            {% endif %}
            {% endfor %}
        </tbody>
    </table>

    <hr class="separator">

    <!-- 订单尾部信息 -->
    <div class="section text-right bold">
        总计: {{ "%.2f" | format(order.total_price.amount | float) }} {{ order.total_price.currency_code | default('') }}
    </div>
    <div class="section">
        客户留言: {{ order.customer_message | default('') }}
    </div>
    <div class="section text-center">
        打印时间: {{ current_print_time }}
    </div>
    <br>
    <br>
</body>
</html>
